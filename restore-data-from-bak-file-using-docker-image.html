<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Restore data from bak-file using Docker Image</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Do you want to restore data from a backup file and don't want to use mssql server? Creating docker image is the answer. Why I am ditching..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Tech-Journal</a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/docker-mssql.html">docker, mssql</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/restore-data-from-bak-file-using-docker-image.html" rel="bookmark"
           title="Permalink to Restore data from bak-file using Docker Image">Restore data from bak-file using Docker Image</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2022-12-04T10:20:00+05:30">
                Published: Sun 04 December 2022
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/mahima-choudhary.html">Mahima Choudhary</a>
        </address>
<p>In <a href="/category/docker-mssql.html">docker, mssql</a>.</p>

</footer><!-- /.post-info -->      <blockquote>
<p>Do you want to restore data from a backup file and don't want to use mssql server?<br>
<strong>Creating docker image is the answer.</strong> </p>
</blockquote>
<h2>Why I am ditching SSMS/mssql server studio</h2>
<ol>
<li>Full blown installation </li>
<li>for fresh DB, it needs a complete clean up.</li>
<li>I just wanted to restore data and do not need to fire queries necessarily. </li>
</ol>
<h2>Build docker image</h2>
<p>Open a text editor and copy below content into <code>Dockerfile</code> </p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">mcr.microsoft.com/mssql/server:2017-latest</span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">ACCEPT_EULA</span><span class="o">=</span>y
<span class="k">ENV</span><span class="w"> </span><span class="nv">MSSQL_SA_PASSWORD</span><span class="o">=</span>YourPassword
<span class="k">ENV</span><span class="w"> </span><span class="nv">MSSQL_PID</span><span class="o">=</span>Express

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">1433</span>

<span class="k">COPY</span><span class="w"> </span>PATH_TO_YOUR_BACKUP_FILE /var/opt/mssql/backup/your_db_name.bak
<span class="k">RUN</span><span class="w"> </span><span class="o">(</span>/opt/mssql/bin/sqlservr --accept-eula <span class="p">&amp;</span> <span class="o">)</span> <span class="p">|</span> grep -q <span class="s2">&quot;Server is listening on&quot;</span> <span class="o">&amp;&amp;</span> /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P <span class="s1">&#39;YourPassword&#39;</span> -Q <span class="s2">&quot;RESTORE DATABASE your_db_name FROM DISK=&#39;/var/opt/mssql/backup/your_db_name.bak&#39; WITH MOVE &#39;your_db_name&#39; TO &#39;/var/opt/mssql/data/your_db_name.mdf&#39;, MOVE &#39;your_db_name_log&#39; TO &#39;/var/opt/mssql/data/your_db_name_log.ldf&#39;&quot;</span>
</code></pre></div>

<p><strong>Let's understand it line by line</strong></p>
<ul>
<li>
<p><code>FROM mcr.microsoft.com/mssql/server:2017-latest</code> specifies base mssql image that we want to extend. I am using <code>2017-latest</code> version. you can use your choice of version. </p>
</li>
<li>
<p><strong>Environment Variables</strong></p>
<ul>
<li><code>ENV ACCEPT_EULA=y</code> to accept <em>End User License Agreement</em></li>
<li><code>ENV MSSQL_SA_PASSWORD=YourPassword</code> specifies your database system administrator password. replace <code>YourPassword</code> with your password.</li>
<li><code>ENV MSSQL_PID=Express</code> specifies the mssql server edition or product key. <em>Default value = <code>Developer</code></em></li>
</ul>
</li>
<li>
<p><code>EXPOSE 1433</code> specifies the port we want to expose to the docker for this image from within the container. Since mssql by default expose <code>1433</code>, so I left it as it is.</p>
</li>
<li>
<p><code>COPY PATH_TO_YOUR_BACKUP_FILE /var/opt/mssql/backup/your_db_name.bak</code> copies your back-up file on the specified location inside container. feel free to change the destination path.</p>
</li>
<li>
<p><strong>Let's break <code>RUN</code> command</strong></p>
<ul>
<li></li>
</ul>
</li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>